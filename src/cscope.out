cscope 15 $HOME/diplomski/visu               0000031492
	@configuration.cpp

1 
	~"cÚfigu¿tiÚ.h
"

3 
	~<QVeùÜ
>

4 
	~"sigÇl.h
"

5 
	~"š¡ª®og.h
"

6 
	~"š¡dig™®.h
"

7 
	~"š¡lš—r.h
"

8 
	~"š¡tim•lÙ.h
"

9 
	~"visu_h–³r.h
"

10 
	~<®gÜ™hm
>

12 
	#DBG_XML
 
	`qDebug
("XML-%d>> %s", 
xml_»ad”
.
	`tok’Ty³
(), xml_»ad”.
	`Çme
().
	`toSŒšg
().
	`toStdSŒšg
().
	`c_¡r
())

	)

14 
	gVisuCÚfigu¿tiÚ
::
	$VisuCÚfigu¿tiÚ
()

18 
	}
}

20 
VisuCÚfigu¿tiÚ
::
	$©ch_š¡rum’t_to_sigÇl
(
VisuIn¡rum’t
* 
š¡rum’t
)

24 
qušt16
 
š¡rum’t_id
 = 
š¡rum’t
->
	`g‘_sigÇl_id
();

25 
i
=0; i<
sigÇls_li¡
.
	`size
(); i++) {

26 ià(
sigÇls_li¡
[
i
]->
	`g‘_id
(è=ğ
š¡rum’t_id
) {

27 
sigÇls_li¡
[
i
]->
	`cÚÃù_š¡rum’t
(
š¡rum’t
);

34 
	}
}

36 
	gQM­
<
	gQSŒšg
, QSŒšg> 
	gVisuCÚfigu¿tiÚ
::
	$·r£_to_m­
(
QXmlSŒ—mR—d”
& 
xml_»ad”
, 
QSŒšg
 
–em’t
)

38 
QM­
<
QSŒšg
, QSŒšg> 
m­
;

39 
QSŒšg
 
Çme
, 
v®ue
;

41  
xml_»ad”
.
	`tok’Ty³
(è!ğ
QXmlSŒ—mR—d”
::
EndEËm’t


42 || 
xml_»ad”
.
	`Çme
(è!ğ
–em’t
) {

44 ià(
xml_»ad”
.
	`tok’Ty³
(è=ğ
QXmlSŒ—mR—d”
::
S¹EËm’t
) {

45 
Çme
 = 
xml_»ad”
.
	`Çme
().
	`toSŒšg
();

48 ià(
xml_»ad”
.
	`tok’Ty³
(è=ğ
QXmlSŒ—mR—d”
::
Ch¬aù”s


49 && !
xml_»ad”
.
	`isWh™e¥aû
()) {

50 
v®ue
 = 
xml_»ad”
.
	`‹xt
().
	`toSŒšg
();

52 
m­
[
Çme
] = 
v®ue
;

54 
DBG_XML
;

57 
xml_»ad”
.
	`»adNext
();

61  
m­
;

63 
	}
}

65 
	gVisuCÚfigu¿tiÚ
::
	$lßd_äom_XML
(
QWidg‘
 *
·»Á
, 
QSŒšg
 
xml_¡ršg
)

67 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
;

68 
QXmlSŒ—mR—d”
 
	`xml_»ad”
(
xml_¡ršg
);

70 
xml_»ad”
.
	`tok’Ty³
(è!ğ
QXmlSŒ—mR—d”
::
EndDocum’t


71 && 
xml_»ad”
.
	`tok’Ty³
(è!ğ
QXmlSŒ—mR—d”
::
Inv®id
) {

73 ià(
xml_»ad”
.
	`tok’Ty³
(è=ğ
QXmlSŒ—mR—d”
::
S¹EËm’t
) {

75 ià(
xml_»ad”
.
	`Çme
() == "signal") {

76 
´İ”t›s
 = 
	`·r£_to_m­
(
xml_»ad”
, "signal");

78 
VisuSigÇl
* 
sigÇl
 = 
Ãw
 
	`VisuSigÇl
(
´İ”t›s
);

79 
sigÇls_li¡
.
	`push_back
(
sigÇl
);

82 ià(
xml_»ad”
.
	`Çme
() == "instrument") {

84 
´İ”t›s
 = 
	`·r£_to_m­
(
xml_»ad”
, "instrument");

85 
VisuIn¡rum’t
* 
š¡rum’t
;

87 ià(
´İ”t›s
["type"] == "ANALOG") {

88 
š¡rum’t
 = 
Ãw
 
	`In¡AÇlog
(
·»Á
, 
´İ”t›s
);

90 ià(
´İ”t›s
["type"] == "DIGITAL") {

91 
š¡rum’t
 = 
Ãw
 
	`In¡Dig™®
(
·»Á
, 
´İ”t›s
);

93 ià(
´İ”t›s
["type"] == "LINEAR") {

94 
š¡rum’t
 = 
Ãw
 
	`In¡Lš—r
(
·»Á
, 
´İ”t›s
);

96 ià(
´İ”t›s
["type"] == "TIME_PLOT") {

97 
š¡rum’t
 = 
Ãw
 
	`In¡TimePlÙ
(
·»Á
, 
´İ”t›s
);

105 
	`©ch_š¡rum’t_to_sigÇl
(
š¡rum’t
);

106 
š¡rum’t
->
	`show
();

107 
š¡rum’ts_li¡
.
	`­³nd
(
š¡rum’t
);

111 ià(
xml_»ad”
.
	`Çme
() == "configuration") {

113 
´İ”t›s
 = 
	`·r£_to_m­
(
xml_»ad”
, "configuration");

114 
	`GET_PROPERTY
(
pÜt
, 
qušt16
);

115 
	`GET_PROPERTY
(
width
, 
qušt16
);

116 
	`GET_PROPERTY
(
height
, 
qušt16
);

117 
	`GET_PROPERTY
(
cŞÜ_background
, 
QCŞÜ
);

121 
xml_»ad”
.
	`»adNext
();

125 
i
=0; i<
sigÇls_li¡
.
	`size
(); i++) {

126 
sigÇls_li¡
[
i
]->
	`š™Ÿl_upd©e
();

128 
	}
}

130 
VisuSigÇl
* 
	gVisuCÚfigu¿tiÚ
::
	$g‘SigÇl
(
qušt16
 
sigÇl_id
)

132  
sigÇls_li¡
[
sigÇl_id
];

133 
	}
}

135 
VisuIn¡rum’t
* 
	gVisuCÚfigu¿tiÚ
::
	$g‘In¡rum’t
(
qušt16
 
š¡rum’t_id
)

137  
š¡rum’ts_li¡
[
š¡rum’t_id
];

138 
	}
}

140 
	gQVeùÜ
<
	gVisuIn¡rum’t
*>& 
	gVisuCÚfigu¿tiÚ
::
	$g‘In¡rum’ts
()

142  
š¡rum’ts_li¡
;

143 
	}
}

145 
qušt16
 
	gVisuCÚfigu¿tiÚ
::
	$g‘PÜt
()

147  
pÜt
;

148 
	}
}

150 
qušt16
 
	gVisuCÚfigu¿tiÚ
::
	$g‘Width
()

152  
width
;

153 
	}
}

155 
qušt16
 
	gVisuCÚfigu¿tiÚ
::
	$g‘Height
()

157  
height
;

158 
	}
}

160 
QCŞÜ
 
	gVisuCÚfigu¿tiÚ
::
	$g‘_cŞÜ_background
()

162  
cŞÜ_background
;

163 
	}
}

	@configuration.h

1 #iâdeà
CONFIGURATION_H


2 
	#CONFIGURATION_H


	)

4 
	~"sigÇl.h
"

5 
	~"š¡rum’t.h
"

6 
	~<QWidg‘
>

7 
	~<QXmlSŒ—mR—d”
>

8 
	~<veùÜ
>

10 şas 
	cVisuCÚfigu¿tiÚ


13 
	m´iv©e
:

14 
¡d
::
veùÜ
<
VisuSigÇl
*> 
sigÇls_li¡
;

15 
	mQVeùÜ
<
	mVisuIn¡rum’t
*> 
	mš¡rum’ts_li¡
;

16 
	mQM­
<
	mQSŒšg
, QSŒšg> 
·r£_to_m­
(
QXmlSŒ—mR—d”
& 
xml_»ad”
, 
QSŒšg
 
–em’t
);

17 
©ch_š¡rum’t_to_sigÇl
(
VisuIn¡rum’t
* 
š¡rum’t
);

20 
qušt16
 
	mpÜt
;

21 
qušt16
 
	mwidth
;

22 
qušt16
 
	mheight
;

23 
QCŞÜ
 
	mcŞÜ_background
;

25 
	mpublic
:

26 
VisuCÚfigu¿tiÚ
();

27 
lßd_äom_XML
(
QWidg‘
 *
·»Á
, 
QSŒšg
 
xml
);

28 
VisuSigÇl
* 
g‘SigÇl
(
qušt16
 
sigÇl_id
);

29 
VisuIn¡rum’t
* 
g‘In¡rum’t
(
qušt16
 
š¡rum’t_id
);

30 
	mQVeùÜ
<
	mVisuIn¡rum’t
*>& 
g‘In¡rum’ts
();

32 
qušt16
 
g‘PÜt
();

33 
qušt16
 
g‘Width
();

34 
qušt16
 
g‘Height
();

35 
QCŞÜ
 
g‘_cŞÜ_background
();

	@datagram.h

1 #iâdeà
DATAGRAM_H


2 
	#DATAGRAM_H


	)

4 
	sVisuD©ag¿m


6 
qušt16
 
	msigÇl_id
;

7 
qušt16
 
	m·ck‘_numb”
;

9 
qušt64
 
	mtime¡amp
;

10 
qušt64
 
	m¿w_v®ue
;

12 
qušt8
 
	mchecksum
;

14 
qušt8
 
g‘Checksum
(cÚ¡ qušt8* 
d©a
, 
qušt16
 
d©ag¿m_size
)

16 
qušt8
 
	mi
 = 0;

17 
qušt8
 
	mchecksum
 = 0x0;

19 
	mi
 = 0; i<
	md©ag¿m_size
; i++)

21 
	mchecksum
 ^ğ*
d©a
;

22 ++
	md©a
;

25 
qDebug
("Checksum is: %x", 
checksum
);

27  
	mchecksum
;

	@instanalog.cpp

1 
	~"š¡ª®og.h
"

3 
	~<QPaš‹r
>

4 
	~<QFÚtM‘rics
>

5 
	~<QtCÜe
>

6 
	~<m©h.h
>

8 
	gIn¡AÇlog
::
	$In¡AÇlog
()

11 
	}
}

13 
In¡AÇlog
::
	$»nd”_¡©ic
(
QPaš‹r
* 
·š‹r
)

15 
·š‹r
->
	`flReù
(0, 0, 
width
, 
height
, 
cŞÜ_background
);

17 
QP’
 
³n
;

18 
³n
.
	`£tWidth
(
lše_thickÃss
);

19 
³n
.
	`£tCŞÜ
(
cŞÜ_¡©ic
);

20 
·š‹r
->
	`£tP’
(
³n
);

21 
QFÚt
 
fÚt
;

22 
fÚt
.
	`£tPoštSize
(
fÚt_size
);

23 
·š‹r
->
	`£tFÚt
(
fÚt
);

26 ià(1 =ğ
d¿w_cœşe
) {

27 
·š‹r
->
	`d¿wArc
Ğ
lše_thickÃss
 + 
off£t_x


28 , 
lše_thickÃss
 + 
off£t_y


29 , 
width
 - 2 * 
lše_thickÃss
 + 
off£t_x


30 , 
height
 - 2 * 
lše_thickÃss
 + 
off£t_y


36 
qušt16
 
¡¬t_Ën
 = 
width
 / 2 * 0.9 - 
lše_thickÃss
 * 2;

37 
qušt16
 
’d_Ën
 = 
width
 / 2 - 
lše_thickÃss
 * 2;

39 
sig_max
 = 
sigÇl
->
	`g‘_max
();

40 
sig_mš
 = 
sigÇl
->
	`g‘_mš
();

41 
sig_¡•
 = (
sig_max
 - 
sig_mš
è/ (
majÜ_út
);

42 
sig_cur
 = 
sig_mš
;

44 
pi
 = 3.14159;

45 
ªgË_cur
 = 
ªgË_¡¬t
;

46 
ªgË_¥ª
 = (2 * 
pi
 - 
ªgË_¡¬t
 - 
ªgË_’d
è/ (
majÜ_út
 * 
mšÜ_út
);

47 
ªgË_sš
;

48 
ªgË_cos
;

50 
qušt16
 
¡¬t_pošt_x
;

51 
qušt16
 
¡¬t_pošt_y
;

52 
qušt16
 
’d_pošt_x
;

53 
qušt16
 
’d_pošt_y
;

55 
QFÚtM‘rics
 
fÚt_m‘rics
 = 
·š‹r
->
	`fÚtM‘rics
();

56 
qušt16
 
Ïb–_width
;

57 
qušt16
 
Ïb–_height
;

58 
qušt16
 
Ïb–_x
;

59 
qušt16
 
Ïb–_y
;

61 
·š‹r
->
	`d¿wText
(
Çme_x
, 
Çme_y
, 
sigÇl
->
	`g‘_Çme
());

63 
i
=0; i<=
majÜ_út
 * 
mšÜ_út
; ++i) {

65 
ªgË_sš
 = 
	`qSš
(
ªgË_cur
);

66 
ªgË_cos
 = 
	`qCos
(
ªgË_cur
);

67 
ªgË_cur
 +ğ
ªgË_¥ª
;

69 
’d_pošt_x
 = -
’d_Ën
 * 
ªgË_sš
 + 
width
 / 2;

70 
’d_pošt_y
 = 
’d_Ën
 * 
ªgË_cos
 + 
height
 / 2;

72 iàĞ(
i
 % 
mšÜ_út
) == 0) {

74 
¡¬t_pošt_x
 = -
¡¬t_Ën
 * 0.9 * 
ªgË_sš
 + 
width
 / 2;

75 
¡¬t_pošt_y
 = 
¡¬t_Ën
 * 0.9 * 
ªgË_cos
 + 
height
 / 2;

78 
QSŒšg
 
Ïb–
 = 
	`QSŒšg
("%1").
	`¬g
(()
sig_cur
);

79 
sig_cur
 +ğ
sig_¡•
;

81 
Ïb–_width
 = 
fÚt_m‘rics
.
	`width
(
Ïb–
);

82 
Ïb–_height
 = 
fÚt_m‘rics
.
	`height
();

83 
Ïb–_x
 = -
Ïb–_¿dius
 * 
ªgË_sš
 + (
width
 - 
Ïb–_width
) / 2;

84 
Ïb–_y
 = 
Ïb–_¿dius
 * 
ªgË_cos
 + (
height
 + 
Ïb–_height
) / 2;

86 
·š‹r
->
	`d¿wText
(
Ïb–_x
 + 
off£t_x
, 
Ïb–_y
 + 
off£t_y
, 
Ïb–
);

91 
¡¬t_pošt_x
 = -
¡¬t_Ën
 * 
ªgË_sš
 + 
width
 / 2;

92 
¡¬t_pošt_y
 = 
¡¬t_Ën
 * 
ªgË_cos
 + 
height
 / 2;

95 
·š‹r
->
	`d¿wLše
Ğ
¡¬t_pošt_x
 + 
off£t_x


96 , 
¡¬t_pošt_y
 + 
off£t_y


97 , 
’d_pošt_x
 + 
off£t_x


98 , 
’d_pošt_y
 + 
off£t_y
);

100 
	}
}

102 
	gIn¡AÇlog
::
	$»nd”_dyÇmic
(
QPaš‹r
* 
·š‹r
)

104 
QP’
 
³n
;

105 
³n
.
	`£tWidth
(
lše_thickÃss
);

106 
³n
.
	`£tCŞÜ
(
cŞÜ_fÜeground
);

107 
·š‹r
->
	`£tP’
(
³n
);

108 
·š‹r
->
	`£tBrush
(
cŞÜ_fÜeground
);

110 
v®ue
 = 
sigÇl
->
	`g‘_nÜm®ized_v®ue
();

112 
pi
 = 3.14159;

113 
ªgË_v®ue
 = (2 * 
pi
 - 
ªgË_¡¬t
 - 
ªgË_’d
è* 
v®ue
 +‡ngle_start;

114 
ªgË_sš
 = 
	`qSš
(
ªgË_v®ue
);

115 
ªgË_cos
 = 
	`qCos
(
ªgË_v®ue
);

116 
qušt16
 
ûÁ”_x
 = 
width
 / 2;

117 
qušt16
 
ûÁ”_y
 = 
height
 / 2;

118 
qušt16
 
¬row_Ën
 = 
ûÁ”_x
 - 
lše_thickÃss
;

120 
qušt16
 
’d_pošt_x
 = -
ªgË_sš
 * 
¬row_Ën
 + 
ûÁ”_x
;

121 
qušt16
 
’d_pošt_y
 = 
ªgË_cos
 * 
¬row_Ën
 + 
ûÁ”_y
;

123 #ifdeà
OPTIMIZE_DRAW


125 
·š‹r
->
	`d¿wLše
(
h®f_width
, 
h®f_height
, 
’d_pošt_x
, 
’d_pošt_y
);

128 
qušt16
 
Ëá_pošt_x
 = -
ªgË_cos
 * 
¬row_width
 + 
ûÁ”_x
;

129 
qušt16
 
Ëá_pošt_y
 = -
ªgË_sš
 * 
¬row_width
 + 
ûÁ”_y
;

131 
qušt16
 
right_pošt_x
 = 
ªgË_cos
 * 
¬row_width
 + 
ûÁ”_x
;

132 
qušt16
 
right_pošt_y
 = 
ªgË_sš
 * 
¬row_width
 + 
ûÁ”_y
;

134 cÚ¡ 
QPoštF
 
pošts
[3] = {

135 
	`QPoštF
(
’d_pošt_x
 + 
off£t_x
, 
’d_pošt_y
 + 
off£t_y
),

136 
	`QPoštF
(
Ëá_pošt_x
 + 
off£t_x
, 
Ëá_pošt_y
 + 
off£t_y
),

137 
	`QPoštF
(
right_pošt_x
 + 
off£t_x
, 
right_pošt_y
 + 
off£t_y
)

140 
·š‹r
->
	`d¿wPŞygÚ
(
pošts
, 3);

142 
	}
}

	@instanalog.h

1 #iâdeà
INSTANALOG_H


2 
	#INSTANALOG_H


	)

4 
	~"š¡rum’t.h
"

6 şas 
	cIn¡AÇlog
 : 
public
 
VisuIn¡rum’t


8 
public
:

9 
In¡AÇlog
();

10 
ex¶ic™
 
In¡AÇlog
(

11 
QWidg‘
 *
·»Á
,

12 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
è: 
	$VisuIn¡rum’t
(
·»Á
, 
´İ”t›s
)

16 
	`GET_PROPERTY
(
lše_thickÃss
, 
qušt8
);

17 
	`GET_PROPERTY
(
majÜ_Ën
, 
qušt8
);

18 
	`GET_PROPERTY
(
mšÜ_Ën
, 
qušt8
);

19 
	`GET_PROPERTY
(
majÜ_út
, 
qušt8
);

20 
	`GET_PROPERTY
(
mšÜ_út
, 
qušt8
);

21 
	`GET_PROPERTY
(
fÚt_size
, 
qušt8
);

22 
	`GET_PROPERTY
(
¬row_width
, 
qušt8
);

23 
	`GET_PROPERTY
(
d¿w_cœşe
, 
qušt8
);

24 
	`GET_PROPERTY
(
Ïb–_¿dius
, 
qušt16
);

25 
	`GET_PROPERTY
(
ªgË_¡¬t
, );

26 
	`GET_PROPERTY
(
ªgË_’d
, );

27 
	`GET_PROPERTY
(
Çme_x
, 
qušt16
);

28 
	`GET_PROPERTY
(
Çme_y
, 
qušt16
);

29 
	`GET_PROPERTY
(
off£t_x
, 
qšt16
);

30 
	`GET_PROPERTY
(
off£t_y
, 
qšt16
);

33 
´iv©e
:

36 
qušt8
 
lše_thickÃss
;

37 
qušt8
 
majÜ_Ën
;

38 
qušt8
 
mšÜ_Ën
;

39 
qušt8
 
majÜ_út
;

40 
qušt8
 
mšÜ_út
;

41 
qušt8
 
fÚt_size
;

42 
qušt8
 
¬row_width
;

43 
qušt8
 
d¿w_cœşe
;

44 
qušt16
 
Ïb–_¿dius
;

45 
ªgË_¡¬t
;

46 
ªgË_’d
;

47 
qušt16
 
Çme_x
;

48 
qušt16
 
Çme_y
;

49 
qšt16
 
off£t_x
;

50 
qšt16
 
off£t_y
;

52 
´Ùeùed
:

53 
vœtu®
 
	`»nd”_¡©ic
(
QPaš‹r
 *
·š‹r
);

54 
vœtu®
 
	`»nd”_dyÇmic
(
QPaš‹r
 *
·š‹r
);

55 
	}
};

	@instdigital.cpp

1 
	~"š¡dig™®.h
"

2 
	~<QPaš‹r
>

3 
	~<QFÚt
>

5 
	gIn¡Dig™®
::
	$In¡Dig™®
()

7 
	}
}

9 
In¡Dig™®
::
	$»nd”_¡©ic
(
QPaš‹r
* 
·š‹r
)

11 
·š‹r
->
	`flReù
(0, 0, 
width
, 
height
, 
cŞÜ_background
);

13 
fÚt
.
	`£tPoštSize
(
fÚt_size
);

14 
	}
}

16 
	gIn¡Dig™®
::
	$»nd”_dyÇmic
(
QPaš‹r
* 
·š‹r
)

18 
QP’
 
³n
;

19 
³n
.
	`£tCŞÜ
(
cŞÜ_fÜeground
);

20 
·š‹r
->
	`£tP’
(
³n
);

21 
·š‹r
->
	`£tFÚt
(
fÚt
);

23 
QSŒšg
 
‹xt
 = 
	`QSŒšg
("%1").
	`¬g
(
sigÇl
->
	`g‘_»®_v®ue
());

25 ià(
show_sigÇl_Çme
) {

26 
‹xt
 = 
sigÇl
->
	`g‘_Çme
() + " = " +ext;

29 ià(
show_sigÇl_un™
) {

30 
‹xt
 +ğ
sigÇl
->
	`g‘_un™
();

32 
·š‹r
->
	`d¿wText
(
·ddšg
, 
height
 -…addšg, 
‹xt
);

34 
	`qDebug
("done");

36 
	}
}

	@instdigital.h

1 #iâdeà
INSTDIGITAL_H


2 
	#INSTDIGITAL_H


	)

4 
	~"š¡rum’t.h
"

6 şas 
	cIn¡Dig™®
 : 
public
 
VisuIn¡rum’t


8 
public
:

9 
In¡Dig™®
();

10 
ex¶ic™
 
In¡Dig™®
(

11 
QWidg‘
 *
·»Á
,

12 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
è: 
	$VisuIn¡rum’t
(
·»Á
, 
´İ”t›s
)

14 
	`GET_PROPERTY
(
fÚt_size
, 
qušt8
);

15 
	`GET_PROPERTY
(
show_sigÇl_Çme
, 
qušt8
);

16 
	`GET_PROPERTY
(
show_sigÇl_un™
, 
qušt8
);

17 
	`GET_PROPERTY
(
·ddšg
, 
qušt8
);

20 
´iv©e
:

22 
qušt8
 
fÚt_size
;

23 
qušt8
 
show_sigÇl_Çme
;

24 
qušt8
 
show_sigÇl_un™
;

25 
qušt8
 
·ddšg
;

28 
QFÚt
 
fÚt
;

29 
QSŒšg
 
fÜm©
;

31 
´Ùeùed
:

32 
vœtu®
 
	`»nd”_¡©ic
(
QPaš‹r
 *
·š‹r
);

33 
vœtu®
 
	`»nd”_dyÇmic
(
QPaš‹r
 *
·š‹r
);

34 
	}
};

	@instlinear.cpp

1 
	~"š¡lš—r.h
"

3 
	gIn¡Lš—r
::
	$In¡Lš—r
()

5 
	}
}

7 
In¡Lš—r
::
	$»nd”_¡©ic
(
QPaš‹r
 *
·š‹r
)

9 
·š‹r
->
	`flReù
(0, 0, 
width
, 
height
, 
cŞÜ_background
);

11 
QP’
 
³n
;

12 
³n
.
	`£tWidth
(
lše_thickÃss
);

13 
³n
.
	`£tCŞÜ
(
cŞÜ_¡©ic
);

14 
·š‹r
->
	`£tP’
(
³n
);

16 
qušt16
 
tÙ®
 = 
majÜ_út
 * 
mšÜ_út
;

17 
qušt16
 
d–
 = (
width
 - 2 * 
hÜ_m¬gš
è/ 
tÙ®
;

19 
qušt16
 
x
 = 
hÜ_m¬gš
;

20 
qušt16
 
tmp_m¬gš
;

22 
sig_max
 = 
sigÇl
->
	`g‘_max
();

23 
sig_mš
 = 
sigÇl
->
	`g‘_mš
();

24 
sig_¡•
 = (
sig_max
 - 
sig_mš
è/ (
majÜ_út
);

25 
sig_cur
 = 
sig_mš
;

26 
QFÚtM‘rics
 
fÚt_m‘rics
 = 
·š‹r
->
	`fÚtM‘rics
();

28 
i
=0; i<=
tÙ®
; ++i) {

30 
tmp_m¬gš
 = 
i
 % 
mšÜ_út
 =ğ0 ? 
v”_m¬gš
 : 
v”_mšÜ_m¬gš
;

32 
·š‹r
->
	`d¿wLše
(
x
, 
v”_m¬gš
, x, 
height
 - 
tmp_m¬gš
);

35 ià(
i
 % 
mšÜ_út
 == 0) {

37 
QSŒšg
 
Ïb–
 = 
	`QSŒšg
("%1").
	`¬g
(()
sig_cur
);

38 
Ïb–_width
 = 
fÚt_m‘rics
.
	`width
(
Ïb–
);

39 
Ïb–_height
 = 
fÚt_m‘rics
.
	`height
();

42 
sig_cur
 +ğ
sig_¡•
;

43 
·š‹r
->
	`d¿wText
(
x
 - 
Ïb–_width
 / 2, 
height
 - 
tmp_m¬gš
 + 
Ïb–_height
, 
Ïb–
);

46 
x
 +ğ
d–
;

49 
b¬_Ëngth
 = 
x
 - 
d–
 - 
hÜ_m¬gš
;

50 
·š‹r
->
	`d¿wLše
(
hÜ_m¬gš
, 
v”_m¬gš
, 
b¬_Ëngth
 + hor_margin, ver_margin);

51 
	}
}

53 
	gIn¡Lš—r
::
	$»nd”_dyÇmic
(
QPaš‹r
 *
·š‹r
)

56 
QP’
 
³n
;

57 
·š‹r
->
	`£tP’
(
³n
);

58 
·š‹r
->
	`£tBrush
(
cŞÜ_fÜeground
);

60 
x
 = 
sigÇl
->
	`g‘_nÜm®ized_v®ue
(è* 
b¬_Ëngth
;

62 
·š‹r
->
	`d¿wReù
(
hÜ_m¬gš
, 5, 
x
, 
v”_m¬gš
 - 10);

64 
	}
}

	@instlinear.h

1 #iâdeà
INSTLINEAR_H


2 
	#INSTLINEAR_H


	)

4 
	~"š¡rum’t.h
"

5 
	~<QPaš‹r
>

7 şas 
	cIn¡Lš—r
 : 
public
 
VisuIn¡rum’t


9 
public
:

10 
In¡Lš—r
();

11 
In¡Lš—r
(

12 
QWidg‘
 *
·»Á
,

13 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
è: 
	$VisuIn¡rum’t
(
·»Á
, 
´İ”t›s
)

15 
	`GET_PROPERTY
(
lše_thickÃss
, 
qušt8
);

16 
	`GET_PROPERTY
(
majÜ_Ën
, 
qušt8
);

17 
	`GET_PROPERTY
(
mšÜ_Ën
, 
qušt8
);

18 
	`GET_PROPERTY
(
majÜ_út
, 
qušt8
);

19 
	`GET_PROPERTY
(
mšÜ_út
, 
qušt8
);

20 
	`GET_PROPERTY
(
fÚt_size
, 
qušt8
);

21 
	`GET_PROPERTY
(
hÜ_m¬gš
, 
qušt16
);

22 
	`GET_PROPERTY
(
v”_m¬gš
, 
qušt16
);

23 
	`GET_PROPERTY
(
v”_mšÜ_m¬gš
, 
qušt16
);

27 
´Ùeùed
:

28 
vœtu®
 
	`»nd”_¡©ic
(
QPaš‹r
 *
·š‹r
);

29 
vœtu®
 
	`»nd”_dyÇmic
(
QPaš‹r
 *
·š‹r
);

31 
´iv©e
:

32 
qušt8
 
lše_thickÃss
;

33 
qušt8
 
majÜ_Ën
;

34 
qušt8
 
mšÜ_Ën
;

35 
qušt8
 
majÜ_út
;

36 
qušt8
 
mšÜ_út
;

37 
qušt8
 
fÚt_size
;

38 
qušt16
 
hÜ_m¬gš
;

39 
qušt16
 
v”_m¬gš
;

40 
qušt16
 
v”_mšÜ_m¬gš
;

43 
qušt16
 
b¬_Ëngth
;

45 
	}
};

	@instrument.cpp

1 
	~"š¡rum’t.h
"

3 
	~<QPaš‹r
>

5 
	gVisuIn¡rum’t
::
	$VisuIn¡rum’t
()

7 
	`qDebug
("Constructing instrument.");

8 
	}
}

15 
	gVisuIn¡rum’t
::
	$sigÇl_upd©ed
(cÚ¡ 
VisuSigÇl
* cÚ¡ 
sigÇl
)

17 
this
->
sigÇl
 = signal;

19 
	`»nd”
();

21 
	`qDebug
("Instrument %d„eceived‚ew signal value for signal %d: %f"

22 , 
id


23 , 
sigÇl
->
	`g‘_id
()

24 , 
sigÇl
->
	`g‘_nÜm®ized_v®ue
());

25 
	}
}

27 
qušt16
 
	gVisuIn¡rum’t
::
	$g‘_id
()

29  
id
;

30 
	}
}

32 
qušt16
 
	gVisuIn¡rum’t
::
	$g‘_sigÇl_id
()

34  
sigÇl_id
;

35 
	}
}

37 
	gVisuIn¡rum’t
::
	$»nd”
()

40 ià(
fœ¡_run
)

42 
QPaš‹r
 
	`·š‹r_¡©ic
(&
pixm­_¡©ic
);

43 
·š‹r_¡©ic
.
	`£tR’d”Hšt
(
QPaš‹r
::
AÁŸlŸsšg
);

44 
	`»nd”_¡©ic
(&
·š‹r_¡©ic
);

45 
fœ¡_run
 = 
çl£
;

48 
QPaš‹r
 
	`·š‹r_dyÇmic
(&
pixm­
);

49 
·š‹r_dyÇmic
.
	`£tR’d”Hšt
(
QPaš‹r
::
AÁŸlŸsšg
);

50 
·š‹r_dyÇmic
.
	`d¿wPixm­
(0, 0, 
pixm­_¡©ic
);

51 
	`»nd”_dyÇmic
(&
·š‹r_dyÇmic
);

53 
	`upd©e
();

54 
	}
}

56 
	gVisuIn¡rum’t
::
	$·štEv’t
(
QPaštEv’t
* 
ev’t
)

58 
QPaš‹r
 
	`·š‹r
(
this
);

59 
·š‹r
.
	`d¿wPixm­
(0, 0, 
pixm­
);

60 
	}
}

	@instrument.h

1 #iâdeà
INSTRUMENT_H


2 
	#INSTRUMENT_H


	)

4 
	~<QtGlob®
>

5 
	~<QWidg‘
>

6 
	~<QCŞÜ
>

7 
	~<QPixm­
>

8 
	~<QM­
>

9 
	~<QPaš‹r
>

11 
	~"visu_h–³r.h
"

12 
	~"sigÇl.h
"

15 
şass
 
	gVisuSigÇl
;

17 şas 
	cVisuIn¡rum’t
 : 
public
 
QWidg‘


20 
´Ùeùed
:

23 
qušt16
 
id
;

24 
qušt16
 
	msigÇl_id
;

25 
QSŒšg
 
	mÇme
;

28 
qušt16
 
	mx
;

29 
qušt16
 
	my
;

30 
qušt16
 
	mwidth
;

31 
qušt16
 
	mheight
;

34 
	mQM­
<
	mQSŒšg
, QSŒšg> 
	m´İ”t›s
;

37 
QCŞÜ
 
	mcŞÜ_background
;

38 
QCŞÜ
 
	mcŞÜ_¡©ic
;

39 
QCŞÜ
 
	mcŞÜ_fÜeground
;

42 
QPixm­
 
	mpixm­
;

43 
QPixm­
 
	mpixm­_¡©ic
;

45 
boŞ
 
	mfœ¡_run
;

46 cÚ¡ 
VisuSigÇl
 *
	msigÇl
;

48 
·štEv’t
(
QPaštEv’t
* 
ev’t
);

50 
vœtu®
 
»nd”_¡©ic
(
QPaš‹r
*) = 0;

51 
vœtu®
 
»nd”_dyÇmic
(
QPaš‹r
*) = 0;

55 
	mpublic
:

56 
VisuIn¡rum’t
();

57 
ex¶ic™
 
VisuIn¡rum’t
(
QWidg‘
 *
·»Á
, 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
)

58 : 
	$QWidg‘
(
·»Á
)

60 
this
->
´İ”t›s
 =…roperties;

62 
	`GET_PROPERTY
(
id
, 
qušt16
);

63 
	`GET_PROPERTY
(
sigÇl_id
, 
qušt16
);

64 
	`GET_PROPERTY
(
Çme
, 
QSŒšg
);

65 
	`GET_PROPERTY
(
x
, 
qušt16
);

66 
	`GET_PROPERTY
(
y
, 
qušt16
);

67 
	`GET_PROPERTY
(
width
, 
qušt16
);

68 
	`GET_PROPERTY
(
height
, 
qušt16
);

69 
	`GET_PROPERTY
(
cŞÜ_background
, 
QCŞÜ
);

70 
	`GET_PROPERTY
(
cŞÜ_¡©ic
, 
QCŞÜ
);

71 
	`GET_PROPERTY
(
cŞÜ_fÜeground
, 
QCŞÜ
);

73 
this
->
fœ¡_run
 = 
Œue
;

74 
this
->
pixm­
 = 
	`QPixm­
(
width
, 
height
);

75 
this
->
pixm­_¡©ic
 = 
	`QPixm­
(
width
, 
height
);

78 
	`£tGeom‘ry
(
x
, 
y
, 
width
, 
height
);

82 
	`sigÇl_upd©ed
(cÚ¡ 
VisuSigÇl
* cÚ¡ 
sigÇl
);

85 
qušt16
 
	`g‘_sigÇl_id
();

86 
qušt16
 
	`g‘_id
();

88 
	`»nd”
();

89 
	}
};

	@insttimeplot.cpp

1 
	~"š¡tim•lÙ.h
"

3 
	gIn¡TimePlÙ
::
	$In¡TimePlÙ
()

5 
	}
}

7 
In¡TimePlÙ
::
	$»nd”_¡©ic
(
QPaš‹r
* 
·š‹r
)

9 
·š‹r
->
	`flReù
(0, 0, 
width
, 
height
, 
cŞÜ_background
);

11 
QP’
 
³n
;

12 
³n
.
	`£tWidth
(
lše_thickÃss
);

13 
³n
.
	`£tCŞÜ
(
cŞÜ_¡©ic
);

14 
·š‹r
->
	`£tP’
(
³n
);

15 
QFÚt
 
fÚt
;

16 
fÚt
.
	`£tPoštSize
(
fÚt_size
);

17 
·š‹r
->
	`£tFÚt
(
fÚt
);

19 
qušt16
 
m¬gš
 = 15;

22 
sig_max
 = 
sigÇl
->
	`g‘_max
();

23 
sig_mš
 = 
sigÇl
->
	`g‘_mš
();

24 
sig_¡•
 = (
sig_max
 - 
sig_mš
è/ (
majÜ_út
);

25 
sig_cur
 = 
sig_mš
;

27 
QSŒšg
 
Ïb–
;

28 
qušt16
 
Ïb–_width
;

29 
qušt16
 
Ïb–_height
;

32 
QFÚtM‘rics
 
fÚt_m‘rics
 = 
·š‹r
->
	`fÚtM‘rics
();

33 
qušt16
 
max_Ïb–_width
 = 0;

34 
i
=0; i<=
majÜ_út
; ++i) {

35 
Ïb–
 = 
	`QSŒšg
("%1").
	`¬g
(
sig_cur
);

36 
sig_cur
 +ğ
sig_¡•
;

37 
Ïb–_width
 = 
fÚt_m‘rics
.
	`width
(
Ïb–
);

38 
max_Ïb–_width
 = max_Ïb–_width < 
Ïb–_width
 ?†abel_width : max_label_width;

41 
¶Ù_¡¬t_x
 = 
m¬gš
 + 
max_Ïb–_width
;

42 
¶Ù_¡¬t_y
 = 
height
 - 
m¬gš
;

43 
¶Ù_’d_x
 = 
width
 - 
m¬gš
;

44 
¶Ù_’d_y
 = 0;

48 
·š‹r
->
	`d¿wLše
(
¶Ù_¡¬t_x
, 
height
 - 
m¬gš
, 
width
 - margin, height - margin);

49 
·š‹r
->
	`d¿wLše
(
¶Ù_¡¬t_x
, 
m¬gš
, m¬gš + 
max_Ïb–_width
, 
height
 - margin);

52 
sig_cur
 = 
sig_mš
;

53 
qšt32
 
y
 = 
¶Ù_¡¬t_y
;

54 
qušt16
 
y_¡•
 = (
height
 - 2 * 
m¬gš
è/ 
majÜ_út
;

56 
i
=0; i<=
majÜ_út
; ++i) {

58 
Ïb–
 = 
	`QSŒšg
("%1").
	`¬g
(
sig_cur
);

59 
Ïb–_width
 = 
fÚt_m‘rics
.
	`width
(
Ïb–
);

61 
·š‹r
->
	`d¿wText
(
max_Ïb–_width
 - 
Ïb–_width
, 
y
 + 
fÚt_m‘rics
.
	`height
(è/ 2, 
Ïb–
);

62 
·š‹r
->
	`d¿wLše
(
max_Ïb–_width
 + 
m¬gš
 / 2, 
y
, 
width
 - margin, y);

64 
y
 -ğ
y_¡•
;

65 
sig_cur
 +ğ
sig_¡•
;

68 
¶Ù_’d_y
 = 
y
 + 
y_¡•
;

72 
Ï¡_upd©e_x
 = 
¶Ù_¡¬t_x
;

73 
Ï¡_upd©e_y
 = 
¶Ù_¡¬t_y
;

74 
Ï¡_m¬k”_time
 = 0;

75 
m¬k”_di¥Ïy_time
 = 0;

76 
Ï¡_m¬k”_x
 = 
¶Ù_¡¬t_x
;

78 
g¿ph_pixm­
 = 
	`QPixm­
(
width
, 
height
);

79 
g¿ph_pixm­
.
	`fl
(
Qt
::
Œª¥¬’t
);

80 
this
->
	`£tA‰ribu‹
(
Qt
::
WA_T¿n¦uûÁBackground
);

81 
g¿ph_·š‹r
 = 
Ãw
 
	`QPaš‹r
(&
g¿ph_pixm­
);

82 
g¿ph_·š‹r
->
	`£tR’d”Hšt
(
QPaš‹r
::
AÁŸlŸsšg
);

83 
	}
}

85 
	gIn¡TimePlÙ
::
	$»nd”_dyÇmic
(
QPaš‹r
* 
·š‹r
)

87 
¿nge_x
 = 
¶Ù_’d_x
 - 
¶Ù_’d_y
;

88 
¿nge_y
 = 
¶Ù_¡¬t_y
 - 
¶Ù_’d_y
;

90 
v®ue
 = 
sigÇl
->
	`g‘_nÜm®ized_v®ue
();

91 
qušt64
 
time¡amp
 = 
sigÇl
->
	`g‘_time¡amp
();

93 
qušt64
 
dt
 = 
time¡amp
 > 
Ï¡_upd©e_time
 ? (timestamp -†ast_update_time) : 0;

94 
Ï¡_upd©e_time
 = 
time¡amp
;

95 
dx
 = 
¿nge_x
 * 
dt
 / (
time¥ª
 * 
ticks_š_£cÚd
);

98 
Ãw_x
 = 
Ï¡_upd©e_x
 + 
dx
;

99 
Ãw_y
 = 
¶Ù_¡¬t_y
 - 
¿nge_y
 * 
v®ue
;

101 ià(
Ãw_x
 > 
¶Ù_’d_x
) {

103 
g¿ph_pixm­
.
	`fl
(
Qt
::
Œª¥¬’t
);

105 
Ãw_x
 = 
¶Ù_¡¬t_x
 +‚ew_x - 
Ï¡_upd©e_x
;

106 
Ï¡_upd©e_x
 = 
¶Ù_¡¬t_x
;

111 ià(
time¡amp
 > 
Ï¡_m¬k”_time
 + 
m¬k”_dt
) {

113 
qušt64
 
m¬k”_time
 = 
time¡amp
 - 
Ï¡_m¬k”_time
;

114 
Ï¡_m¬k”_x
 +ğ
¿nge_x
 * 
m¬k”_time
 / (
time¥ª
 * 
ticks_š_£cÚd
);

116 ià(
Ï¡_m¬k”_x
 > 
¶Ù_’d_x
) {

117 
Ï¡_m¬k”_x
 = 
¶Ù_¡¬t_x
 +†a¡_m¬k”_x - 
¶Ù_’d_x
;

120 
Ï¡_m¬k”_time
 = 
time¡amp
;

121 
g¿ph_·š‹r
->
	`d¿wLše
(
Ï¡_m¬k”_x
, 
¶Ù_¡¬t_y
,†a¡_m¬k”_x, 
¶Ù_’d_y
);

123 
m¬k”_di¥Ïy_time
 +ğ
m¬k”_dt
 / 
ticks_š_£cÚd
;

124 
g¿ph_·š‹r
->
	`d¿wText
(
Ï¡_m¬k”_x
, 
height
, 
	`QSŒšg
("%1").
	`¬g
(
m¬k”_di¥Ïy_time
));

129 
g¿ph_·š‹r
->
	`d¿wLše
(
Ï¡_upd©e_x
, 
Ï¡_upd©e_y
, 
Ãw_x
, 
Ãw_y
);

130 
·š‹r
->
	`d¿wPixm­
(0, 0, 
g¿ph_pixm­
);

132 
Ï¡_upd©e_x
 = 
Ãw_x
;

133 
Ï¡_upd©e_y
 = 
Ãw_y
;

135 
·š‹r
->
	`d¿wText
(
width
 - 100, 
height
, 
	`QSŒšg
("Time: %1 s").
	`¬g
(()
time¡amp
 / 
ticks_š_£cÚd
));

145 
	}
}

	@insttimeplot.h

1 #iâdeà
INSTTIMEPLOT_H


2 
	#INSTTIMEPLOT_H


	)

4 
	~"š¡rum’t.h
"

6 şas 
	cIn¡TimePlÙ
 : 
public
 
VisuIn¡rum’t


8 
public
:

9 
In¡TimePlÙ
();

10 
ex¶ic™
 
In¡TimePlÙ
(

11 
QWidg‘
 *
·»Á
,

12 
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
è: 
	$VisuIn¡rum’t
(
·»Á
, 
´İ”t›s
)

14 
	`GET_PROPERTY
(
lše_thickÃss
, 
qušt8
);

15 
	`GET_PROPERTY
(
majÜ_Ën
, 
qušt8
);

16 
	`GET_PROPERTY
(
mšÜ_Ën
, 
qušt8
);

17 
	`GET_PROPERTY
(
majÜ_út
, 
qušt8
);

18 
	`GET_PROPERTY
(
mšÜ_út
, 
qušt8
);

19 
	`GET_PROPERTY
(
fÚt_size
, 
qušt8
);

20 
	`GET_PROPERTY
(
ticks_š_£cÚd
, 
qušt64
);

21 
	`GET_PROPERTY
(
time¥ª
, 
qušt64
);

22 
	`GET_PROPERTY
(
m¬k”_dt
, 
qušt64
);

25 
´iv©e
:

28 
qušt8
 
lše_thickÃss
;

29 
qušt8
 
majÜ_Ën
;

30 
qušt8
 
mšÜ_Ën
;

31 
qušt8
 
majÜ_út
;

32 
qušt8
 
mšÜ_út
;

33 
qušt8
 
fÚt_size
;

35 
qušt64
 
ticks_š_£cÚd
;

36 
qušt64
 
time¥ª
;

37 
qušt64
 
m¬k”_dt
;

40 
qušt16
 
¶Ù_¡¬t_x
;

41 
qušt16
 
¶Ù_¡¬t_y
;

42 
qušt16
 
¶Ù_’d_x
;

43 
qušt16
 
¶Ù_’d_y
;

44 
qušt64
 
Ï¡_upd©e_time
;

45 
qušt64
 
Ï¡_m¬k”_time
;

46 
qušt64
 
m¬k”_di¥Ïy_time
;

47 
Ï¡_m¬k”_x
;

48 
Ï¡_upd©e_x
;

49 
Ï¡_upd©e_y
;

51 
QPixm­
 
g¿ph_pixm­
;

52 
QPaš‹r
* 
g¿ph_·š‹r
;

54 
´Ùeùed
:

55 
vœtu®
 
	`»nd”_¡©ic
(
QPaš‹r
 *
·š‹r
);

56 
vœtu®
 
	`»nd”_dyÇmic
(
QPaš‹r
 *
·š‹r
);

58 
	}
};

	@main.cpp

1 
	~"mašwšdow.h
"

2 
	~<QAµliÿtiÚ
>

4 
	~"£rv”.h
"

5 
	~"visu­¶iÿtiÚ.h
"

7 
	$maš
(
¬gc
, *
¬gv
[])

9 
QAµliÿtiÚ
 
	`a
(
¬gc
, 
¬gv
);

11 
VisuAµliÿtiÚ
 *
­¶iÿtiÚ
 = 
Ãw
 
	`VisuAµliÿtiÚ
();

12 
­¶iÿtiÚ
->
	`show
();

14 
­¶iÿtiÚ
->
	`run
();

16  
a
.
	`exec
();

17 
	}
}

	@mainwindow.cpp

1 
	~"mašwšdow.h
"

2 
	~"ui_mašwšdow.h
"

4 
	gMašWšdow
::
	$MašWšdow
(
QWidg‘
 *
·»Á
) :

5 
	`QMašWšdow
(
·»Á
),

6 
	$ui
(
Ãw
 
Ui
::
MašWšdow
)

8 
ui
->
	`£tupUi
(
this
);

11 
	}
}

13 
	gMašWšdow
::~
	$MašWšdow
()

15 
d–‘e
 
ui
;

16 
	}
}

	@mainwindow.h

1 #iâdeà
MAINWINDOW_H


2 
	#MAINWINDOW_H


	)

4 
	~<QMašWšdow
>

6 
Çme¥aû
 
	gUi
 {

7 
şass
 
	gMašWšdow
;

10 şas 
	cMašWšdow
 : 
public
 
QMašWšdow


12 
Q_OBJECT


14 
public
:

15 
ex¶ic™
 
MašWšdow
(
QWidg‘
 *
·»Á
 = 0);

16 ~
MašWšdow
();

18 
	m´iv©e
:

19 
Ui
::
MašWšdow
 *
ui
;

	@measurementconfig.cpp

1 
	~"m—su»m’tcÚfig.h
"

5 
	gM—su»m’tCÚfig
::
	$M—su»m’tCÚfig
()

11 
	}
}

	@measurementconfig.h

1 #iâdeà
MEASUREMENTCONFIG_H


2 
	#MEASUREMENTCONFIG_H


	)

4 
	~<QVeùÜ
>

5 
	~"sigÇl.h
"

7 şas 
	cM—su»m’tCÚfig


10 
	m´iv©e
:

12 
QVeùÜ
<
VisuSigÇl
> 
sigÇl_li¡
;

19 
	mpublic
:

20 
M—su»m’tCÚfig
();

22 
addSigÇl
(cÚ¡ 
VisuSigÇl
& 
sigÇl
);

	@server.cpp

1 
	~"£rv”.h
"

2 
	~"d©ag¿m.h
"

3 
	~<QUdpSock‘
>

4 
	~<q’dŸn.h
>

6 
	gVisuS”v”
::
	$VisuS”v”
()

8 
QObjeù
::
	`cÚÃù
(&
sock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`hªdËD©ag¿m
()));

9 
	}
}

11 
	gVisuS”v”
::
	$¡¬t
()

13 
	`qDebug
("S”v” i ruÂšg oÀpÜˆ%d.", 
pÜt
);

14 
sock‘
.
	`bšd
(
QHo¡Add»ss
::
LoÿlHo¡
, 
pÜt
);

15 
	}
}

17 
	gVisuS”v”
::
	$¡İ
()

19 
sock‘
.
	`şo£
();

20 
	}
}

22 
	gVisuS”v”
::
	$hªdËD©ag¿m
()

24 
qušt64
 
d©ag¿m_size
;

25 
QBy‹A¼ay
 
	`bufãr
(
DATAGRAM_SIZE
, 0);

26 * 
bufãr_d©a_±r
 = (*)
bufãr
.
	`d©a
();

27 
QHo¡Add»ss
 
£nd”_add»ss
;

28 
qušt16
 
£nd”_pÜt
;

30 
sock‘
.
	`hasP’dšgD©ag¿ms
()) {

32 
d©ag¿m_size
 = 
sock‘
.
	`³ndšgD©ag¿mSize
();

34 
bufãr
.
	`»size
(
sock‘
.
	`³ndšgD©ag¿mSize
());

35 
sock‘
.
	`»adD©ag¿m
(
bufãr_d©a_±r
, 
d©ag¿m_size
, &
£nd”_add»ss
, &
£nd”_pÜt
);

37 iàĞ
DATAGRAM_SIZE
 =ğ
d©ag¿m_size
 &&

38 
VisuD©ag¿m
::
	`g‘Checksum
((cÚ¡ 
qušt8
*)
bufãr_d©a_±r
, 
DATAGRAM_SIZE
 - 1) == (quint8)buffer_data_ptr[DATAGRAM_SIZE - 1]) {

42 
VisuD©ag¿m
 
d©ag¿m
;

44 
d©ag¿m
.
sigÇl_id
 = 
qFromBigEndŸn
<
qušt16
>((
uch¬
*)
bufãr_d©a_±r
);

45 
bufãr_d©a_±r
 += 2;

47 
d©ag¿m
.
·ck‘_numb”
 = 
qFromBigEndŸn
<
qušt16
>((
uch¬
*)
bufãr_d©a_±r
);

48 
bufãr_d©a_±r
 += 2;

50 
d©ag¿m
.
time¡amp
 = 
qFromBigEndŸn
<
qušt64
>((
uch¬
*)
bufãr_d©a_±r
);

51 
bufãr_d©a_±r
 += 8;

53 
d©ag¿m
.
¿w_v®ue
 = 
qFromBigEndŸn
<
qušt64
>((
uch¬
*)
bufãr_d©a_±r
);

54 
bufãr_d©a_±r
 += 8;

56 
d©ag¿m
.
checksum
 = *
bufãr_d©a_±r
;

58 
	`upd©eSigÇl
(
d©ag¿m
);

62 
	`qDebug
("Bad…ackage.");

65 
	}
}

67 
	gVisuS”v”
::
	$upd©eSigÇl
(cÚ¡ 
VisuD©ag¿m
& 
d©ag¿m
)

69 
cÚfigu¿tiÚ
->
	`g‘SigÇl
(
d©ag¿m
.
sigÇl_id
)->
	`d©ag¿m_upd©e
(datagram);

70 
	}
}

	@server.h

1 #iâdeà
SERVER_H


2 
	#SERVER_H


	)

4 
	~<QObjeù
>

5 
	~<QUdpSock‘
>

7 
	~"sigÇl.h
"

8 
	~"cÚfigu¿tiÚ.h
"

10 şas 
	cVisuS”v”
 : 
public
 
QObjeù


12 
Q_OBJECT


14 
´iv©e
:

16 
qušt16
 
pÜt
;

17 cÚ¡ 
qušt8
 
	mDATAGRAM_SIZE
 = 21;

19 
QUdpSock‘
 
	msock‘
;

20 
VisuCÚfigu¿tiÚ
 *
	mcÚfigu¿tiÚ
;

22 
upd©eSigÇl
(cÚ¡ 
VisuD©ag¿m
& 
d©ag¿m
);

24 
public
 
	m¦Ùs
:

25 
hªdËD©ag¿m
();

27 
	mpublic
:

28 
VisuS”v”
();

29 
	$VisuS”v”
(
VisuCÚfigu¿tiÚ
* 
cÚfigu¿tiÚ
è: 
	$cÚfigu¿tiÚ
(
cÚfigu¿tiÚ
) {

30 
pÜt
 = 
cÚfigu¿tiÚ
->
	`g‘PÜt
();

31 
	`qDebug
("PÜˆi now %d", 
pÜt
);

32 
QObjeù
::
	`cÚÃù
(&
sock‘
, 
	`SIGNAL
(
	`»adyR—d
()), 
this
, 
	`SLOT
(
	`hªdËD©ag¿m
()));

34 
	`¡¬t
();

35 
	`¡İ
();

36 
	}
};

	@signal.cpp

1 
	~"sigÇl.h
"

8 
	gVisuSigÇl
::
	$cÚÃù_š¡rum’t
(
VisuIn¡rum’t
* 
š¡rum’t
)

10 
š¡rum’ts
.
	`­³nd
(
š¡rum’t
);

11 
	}
}

18 
	gVisuSigÇl
::
	$discÚÃù_š¡rum’t
(
VisuIn¡rum’t
* 
š¡rum’t
)

21 
i
=0; i<
š¡rum’ts
.
	`size
(); i++)

24 ià(
š¡rum’ts
.
	`©
(
i
è=ğ
š¡rum’t
)

26 
š¡rum’ts
.
	`»move
(
i
, 1);

31 
	}
}

37 
	gVisuSigÇl
::
	$nÙifyIn¡rum’ts
()

39 
i
=0; i<
š¡rum’ts
.
	`size
(); i++)

41 
š¡rum’ts
.
	`©
(
i
)->
	`sigÇl_upd©ed
(
this
);

43 
	}
}

45 
qušt16
 
	gVisuSigÇl
::
	$g‘_id
() const

47  
id
;

48 
	}
}

55 
qušt64
 
	gVisuSigÇl
::
	$g‘_¿w_v®ue
() const

57  
¿w_v®ue
;

58 
	}
}

65 
	gVisuSigÇl
::
	$g‘_çùÜ
() const

67  
çùÜ
;

68 
	}
}

75 
	gVisuSigÇl
::
	$g‘_off£t
() const

77  
off£t
;

78 
	}
}

85 
	gVisuSigÇl
::
	$g‘_»®_v®ue
() const

87  
¿w_v®ue
 * 
çùÜ
 + 
off£t
;

88 
	}
}

90 
	gVisuSigÇl
::
	$g‘_nÜm®ized_v®ue
() const

92 
v®ue
 = 
¿w_v®ue
 / (
max
 - 
mš
);

93  
v®ue
 >= 0.0 && value <= 1.0 ? value : 0.0;

94 
	}
}

100 
	gVisuSigÇl
::
	$d©ag¿m_upd©e
(cÚ¡ 
VisuD©ag¿m
& 
d©ag¿m
)

103 
¿w_v®ue
 = 
d©ag¿m
.raw_value;

104 
time¡amp
 = 
d©ag¿m
.timestamp;

106 
	`nÙifyIn¡rum’ts
();

107 
	}
}

114 
	gVisuSigÇl
::
	$š™Ÿl_upd©e
()

116 
¿w_v®ue
 = 0;

117 
time¡amp
 = 0;

119 
	`nÙifyIn¡rum’ts
();

120 
	}
}

122 
	gVisuSigÇl
::
	$g‘_mš
() const

124  
mš
;

125 
	}
}

127 
	gVisuSigÇl
::
	$g‘_max
() const

129  
max
;

130 
	}
}

132 
QSŒšg
 
	gVisuSigÇl
::
	$g‘_Çme
() const

134  
Çme
;

135 
	}
}

137 
QSŒšg
 
	gVisuSigÇl
::
	$g‘_un™
() const

139  
un™
;

140 
	}
}

142 
qušt64
 
	gVisuSigÇl
::
	$g‘_time¡amp
() const

144  
time¡amp
;

145 
	}
}

	@signal.h

1 #iâdeà
SIGNAL_H


2 
	#SIGNAL_H


	)

4 
	~<QtGlob®
>

5 
	~<QVeùÜ
>

6 
	~<QSŒšg
>

8 
	~"š¡rum’t.h
"

9 
	~"d©ag¿m.h
"

10 
	~"visu_h–³r.h
"

12 
şass
 
	gVisuIn¡rum’t
;

13 şas 
	cVisuSigÇl


15 
	m´iv©e
:

18 
qušt16
 
id
;

19 
QSŒšg
 
	mÇme
;

20 
QSŒšg
 
	mun™
;

21 
	mçùÜ
;

22 
	moff£t
;

23 
	mmax
;

24 
	mmš
;

26 
qušt64
 
	mtime¡amp
;

27 
qušt64
 
	m¿w_v®ue
;

29 
	mQVeùÜ
<
	mVisuIn¡rum’t
*> 
	mš¡rum’ts
;

32 
nÙifyIn¡rum’ts
();

34 
	mpublic
:

35 
VisuSigÇl
();

36 
VisuSigÇl
(
QM­
<
QSŒšg
, QSŒšg> 
´İ”t›s
)

38 
GET_PROPERTY
(
id
, 
qušt16
);

39 
GET_PROPERTY
(
Çme
, 
QSŒšg
);

40 
GET_PROPERTY
(
un™
, 
QSŒšg
);

41 
GET_PROPERTY
(
çùÜ
, );

42 
GET_PROPERTY
(
off£t
, );

43 
GET_PROPERTY
(
max
, );

44 
GET_PROPERTY
(
mš
, );

47 
š™Ÿl_upd©e
();

48 
d©ag¿m_upd©e
(cÚ¡ 
VisuD©ag¿m
& 
d©ag¿m
);

49 
£t_¿w_¿lue
(
qušt64
 
v®ue
);

50 
qušt64
 
	$g‘_¿w_v®ue
() const;

51 
	`£t_time¡amp
(
qušt64
 
time¡amp
);

52 
qušt64
 
	$g‘_time¡amp
() const;

53 
qušt16
 
	$g‘_id
() const;

54 
	$g‘_çùÜ
() const;

55 
	$g‘_off£t
() const;

56 
	$g‘_»®_v®ue
() const;

57 
	$g‘_nÜm®ized_v®ue
() const;

58 
	$g‘_mš
() const;

59 
	$g‘_max
() const;

60 
QSŒšg
 
	$g‘_Çme
() const;

61 
QSŒšg
 
	$g‘_un™
() const;

64 
	`cÚÃù_š¡rum’t
(
VisuIn¡rum’t
* 
š¡rum’t
);

65 
	`discÚÃù_š¡rum’t
(
VisuIn¡rum’t
* 
š¡rum’t
);

66 
	}
};

	@visu_helper.h

1 #iâdeà
VISU_HELPER_H


2 
	#VISU_HELPER_H


	)

4 
	#GET_PROPERTY
(
KEY
, 
TYPE
èKEY = 
VisuH–³r
::
g‘_
##
	`TYPE
 (#KEY, 
´İ”t›s
)

	)

6 şas 
	cVisuH–³r
 {

8 
	mpublic
:

10 
qušt8
 
g‘_qušt8
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

12 ià(
	m´İ”t›s
.
cÚšs
(
key
)) {

13  
	m´İ”t›s
[
key
].
toIÁ
();

19 
qušt16
 
g‘_qušt16
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

21 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

22  
	g´İ”t›s
[
key
].
toIÁ
();

28 
qšt16
 
g‘_qšt16
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

30 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

31  
	g´İ”t›s
[
key
].
toIÁ
();

37 
qušt64
 
g‘_qušt64
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

39 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

40  
	g´İ”t›s
[
key
].
toIÁ
();

46 
g‘_doubË
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

48 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

49  
	g´İ”t›s
[
key
].
toDoubË
();

55 
QSŒšg
 
g‘_QSŒšg
(QSŒšg 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

57 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

58  
	g´İ”t›s
[
key
];

64 
QCŞÜ
 
g‘_QCŞÜ
(
QSŒšg
 
key
, 
QM­
<QSŒšg, QSŒšg> 
´İ”t›s
)

66 ià(
	g´İ”t›s
.
cÚšs
(
key
)) {

68 
QSŒšgLi¡
 
	g·¹s
 = 
´İ”t›s
[
key
].
¥l™
(",");

69 ià(
	g·¹s
.
Ëngth
() == 4) {

70  
QCŞÜ
Ğ
·¹s
[0].
toIÁ
()

71 , 
·¹s
[1].
toIÁ
()

72 , 
·¹s
[2].
toIÁ
()

73 , 
·¹s
[3].
toIÁ
());

77  
QCŞÜ
(0, 0, 0, 0);

	@visuapplication.cpp

1 
	~"visu­¶iÿtiÚ.h
"

3 
	~<QPaš‹r
>

4 
	~<QFe
>

5 
	~<QBy‹A¼ay
>

7 
	gVisuAµliÿtiÚ
::
	$VisuAµliÿtiÚ
()

10 
QFe
 
	`xml_fe
("../../misc/sample.xml");

11 
xml_fe
.
	`İ’
(
QFe
::
R—dOÆy
);

12 
QBy‹A¼ay
 
cÚ‹Ás
 = 
xml_fe
.
	`»adAÎ
();

14 
cÚfigu¿tiÚ
.
	`lßd_äom_XML
(
this
, 
	`QSŒšg
(
cÚ‹Ás
));

16 
	`qDebug
("CÚfig size: %dx%d", 
cÚfigu¿tiÚ
.
	`g‘Width
(), cÚfigu¿tiÚ.
	`g‘Height
());

19 
	`£tGeom‘ry
(100, 100, 
cÚfigu¿tiÚ
.
	`g‘Width
(), cÚfigu¿tiÚ.
	`g‘Height
());

22 
QCŞÜ
 
	`cŞÜ_background
(
cÚfigu¿tiÚ
.
	`g‘_cŞÜ_background
());

23 
QSŒšg
 
¡yËsh“t
 = 
	`QSŒšg
("background-color:„gb(%1, %2, %3);")

24 .
	`¬g
(
cŞÜ_background
.
	`»d
())

25 .
	`¬g
(
cŞÜ_background
.
	`g»’
())

26 .
	`¬g
(
cŞÜ_background
.
	`blue
());

27 
	`£tStyËSh“t
(
¡yËsh“t
);

39 
£rv”
 = 
Ãw
 
	`VisuS”v”
(&
cÚfigu¿tiÚ
);

40 
	}
}

43 
	gVisuAµliÿtiÚ
::
	$run
()

45 
£rv”
->
	`¡¬t
();

46 
	}
}

	@visuapplication.h

1 #iâdeà
VISUAPPLICATION_H


2 
	#VISUAPPLICATION_H


	)

4 
	~<QWidg‘
>

5 
	~"cÚfigu¿tiÚ.h
"

6 
	~"£rv”.h
"

9 şas 
	cVisuAµliÿtiÚ
 : 
public
 
QWidg‘


11 
´iv©e
:

12 
VisuCÚfigu¿tiÚ
 
cÚfigu¿tiÚ
;

13 
VisuS”v”
 *
	m£rv”
;

15 
	mpublic
:

16 
VisuAµliÿtiÚ
();

17 
run
();

	@
1
.
0
25
362
configuration.cpp
configuration.h
datagram.h
instanalog.cpp
instanalog.h
instdigital.cpp
instdigital.h
instlinear.cpp
instlinear.h
instrument.cpp
instrument.h
insttimeplot.cpp
insttimeplot.h
main.cpp
mainwindow.cpp
mainwindow.h
measurementconfig.cpp
measurementconfig.h
server.cpp
server.h
signal.cpp
signal.h
visu_helper.h
visuapplication.cpp
visuapplication.h
